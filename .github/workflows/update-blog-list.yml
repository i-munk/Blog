name: Update Blog List

on:
  push:
    branches:
      - main  # main ë¸Œëœì¹˜ì— í‘¸ì‹œë  ë•Œ ì‹¤í–‰

permissions: 
  contents: write  # âœ… GitHub Actionsê°€ ë¦¬í¬ì§€í† ë¦¬ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆë„ë¡ ê¶Œí•œ ë¶€ì—¬

jobs:
  update-blog-list:
    runs-on: ubuntu-latest

    steps:
      - name: ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: í˜„ì¬ ë””ë ‰í„°ë¦¬ ë° íŒŒì¼ í™•ì¸ (ë””ë²„ê¹…)
        run: |
          pwd
          ls -la blog/

      - name: Python ì„¤ì¹˜
        uses: actions/setup-python@v3
        with:
          python-version: '3.x'

      - name: JSON ì—…ë°ì´íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
        run: |
          python update_blog_list.py  # ì‹¤í–‰ ê²½ë¡œ í™•ì¸ í›„ ì‹¤í–‰

      - name: ë³€ê²½ ì‚¬í•­ ì»¤ë°‹ ë° í‘¸ì‹œ (ë³€ê²½ëœ ê²½ìš°ë§Œ ì‹¤í–‰)
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "github-actions@github.com"

          # GitHub Actions ì¸ì¦ì„ ìœ„í•œ GITHUB_TOKEN ì„¤ì •
          git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git
          
          # ë³€ê²½ ì‚¬í•­ í™•ì¸ í›„ ì»¤ë°‹ ë° í‘¸ì‹œ
          if [[ `git status --porcelain` ]]; then
            git add blog/blog-list.json
            git commit -m "ìë™ ì—…ë°ì´íŠ¸: blog-list.json"
            git push origin main
          else
            echo "ğŸ”¹ ë³€ê²½ ì‚¬í•­ ì—†ìŒ. í‘¸ì‹œí•˜ì§€ ì•ŠìŒ."
          fi